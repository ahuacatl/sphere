"use strict";!function(e){function t(){var e=window.location.pathname,t=e.split("/"),a=t[t.length-2];return"database"===a?null:a}function a(e){var t=arguments.length<=1||void 0===arguments[1]?window.location.href:arguments[1];e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=a.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}e(document).ready(function(){var n=new L.LatLng(50.5,30.51),i=new L.Map("map",{center:n,zoom:15}),s=(L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}).addTo(i),new L.Marker(n));i.addLayer(s),s.bindPopup("<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Nullam malesuada erat ut turpis. Suspendisse urna nibh, viverra non, semper suscipit, posuere a, pede.</p><p>Donec nec justo eget felis facilisis fermentum. Aliquam porttitor mauris sit amet orci. Aenean dignissim pellentesque felis.</p>");var o="ITI5JHZJM9",r="5828bf68d90dbb0251e6ce88aabe2e07",l="diybiosphere",c='<div class="text-center">No results found matching <strong>{{query}}</strong>.</div>',d='\n      <div class="row" style="\n        border-top: 1px solid;\n        border-bottom: 1px solid;\n        border-color: #DDDDDD;\n        padding: 10px 0px 10px 5px;">\n        <div class="col-sm-2">\n          <img src="{{ logo }}" alt="logo" class="img-responsive" />\n        </div>\n        <div class="col-sm-8">\n          <div>\n            <b>{{{ _highlightResult.title.value }}}</b>\n            <a href="{{url}}" class="text-info"><i class="fa fa-link"></i></a>\n            <a href="{{website}}" class="text-info" target="_blank"><i class="fa fa-external-link"></i></a>\n          </div>\n          <div>\n            <p>{{ text }}</p>\n          </div>\n        </div>\n        <div class="col-sm-2">\n          <div style="\n            border: 0.5px solid;\n            border-color: #DDDDDD;\n            width: 130px;\n            padding: 5px 5px 5px 10px">\n            {{#collection}}\n              <div><i class="fa fa-lg fa-flask"></i><b>{{ collection }}</b></div>\n            {{/collection}}\n            {{#since}}\n              <div><i class="fa fa-gift"></i> {{ since }}</div>\n            {{/since}}\n            {{#host.name}}\n              <div><i class="fa fa-home"></i> {{ host.name }}</div>\n            {{/host.name}}\n            {{#country}}\n            <div><i class="fa fa-globe"></i> {{city}}, {{country}}</div>\n            {{/country}}\n          </div>\n        </div>\n      </div>',p=instantsearch({appId:o,apiKey:r,indexName:l,urlSync:!0});p.addWidget(instantsearch.widgets.searchBox({container:"#search-box",placeholder:"Search for entries..."})),p.addWidget(instantsearch.widgets.hits({container:"#hits-container",templates:{empty:c,item:d},hitsPerPage:3})),p.addWidget(instantsearch.widgets.pagination({container:"#pagination-container"})),p.start();var u=e("#entries").DataTable({paging:!0,ordering:!0,dom:'<"top"i<"pull-right"B>>rt<"bottom"ip<"clear">>',buttons:[{extend:"csvHtml5",text:'<i class="fa fa-download"></i> Download as CSV',titleAttr:"CSV",className:"link selectable text-dark"}],columnDefs:[{visible:!0,targets:0,name:"title",data:"title",render:function(e,t,a){return'<a class="link selectable" href="'+a.url+'">'+e+"</a>"}},{visible:!0,targets:1,name:"collection",data:"collection"},{visible:!0,targets:2,name:"since",data:"since"},{visible:!0,targets:3,name:"type",data:"type"},{visible:!0,targets:4,name:"city",data:"city"},{visible:!0,targets:5,name:"country",data:"country"},{visible:!0,targets:6,name:"state",data:"state"},{visible:!0,targets:7,name:"host",data:"host",render:function(e){var t="",a="",n="";return null!==e?(t=e.name||"",null!==e.web&&(a='\n                  <a class="link selectable" href="'+e.web+'">\n                    <i class="fa fa-link"></i>\n                  </a>\n                '),null!==e.sphere&&(n='\n                  <a class="link selectable" href="'+e.sphere+'">\n                    <i class="fa fa-external-link"></i>\n                  </a>\n                '),t+" "+a+" "+n):""}},{visible:!1,targets:8,name:"region",data:"region"},{visible:!1,targets:9,name:"tags",data:"tags"}],language:{thousands:",",zeroRecords:"Nothing found - sorry",info:"Showing _TOTAL_ entries",infoEmpty:"Showing _TOTAL_ entries",infoFiltered:"from _MAX_ total"}});e("#entries tfoot td").each(function(){var t=e(this),a=t.text(),n=a.toLowerCase();t.html('<input id="'+n+'" type="text" placeholder="Search '+a+'" />')}),u.columns().every(function(){var t=this;e("input",this.footer()).on("keyup change",function(){t.search()!==this.value&&t.search(this.value).draw()})}),e.getJSON("/data/database.json").done(function(e){var a=[],n=e.database,i=t();console.log("collection to use: ",i),a=i?n.filter(function(e){return e.collection===i}):n,u.rows.add(a).draw()}).fail(function(e,t,a){console.error("failure getting database..."),console.error(t+", "+a)});var g=e("#search");g.on("keyup click",function(){u.search(g.val(),!1,!0).draw()}),a("q")&&g.val(a("q")).trigger("keyup")})}($);